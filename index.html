<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title> UofT Division of Anatomy | GRANTedViewer</title>
</head>
<body style="text-align: center">

    <canvas id="unity-canvas" width=1280 height=720 style="width: 1280px; height: 720px; background: #FFFFFF"></canvas>

    <div>
        <button id="blue-button">Os Coxa</button>
        <button id="red-button">Upper Limb</button>
        <button id="json-button">JSON</button>
        <button id="full-screen">Full Screen</button>
    </div>

    <script src="Build/ViewGL.loader.js"></script>

    <script>
        var bluebutton = document.querySelector("#blue-button");
        var redbutton = document.querySelector("#red-button");
        var jsonbutton = document.querySelector("#json-button");
        var fullscreenButton = document.querySelector("#full-screen");

        createUnityInstance(document.querySelector("#unity-canvas"), {
            dataUrl: "Build/ViewGL.data",
            frameworkUrl: "Build/ViewGL.framework.js",
            codeUrl: "Build/ViewGL.wasm",
            streamingAssetsUrl: "StreamingAssets",
            companyName: "DefaultCompany",
            productName: "GRANTedViewer",
            productVersion: "0.1.0",
            // matchWebGLToCanvasSize: false, // Uncomment this to separately control WebGL canvas render size and DOM element size.
            // devicePixelRatio: 1, // Uncomment this to override low DPI rendering on high DPI displays.
        }).then((unityInstance) => {

            //button to pass download URL to DownloadFile Method in unity webgl (attached on GlbImporterManager GameObject)
            bluebutton.onclick = () => {
                unityInstance.SendMessage('GlbImporterManager', 'DownloadFile', 'https://firebasestorage.googleapis.com/v0/b/test2-repo.appspot.com/o/Pelvis%2FFull_Pelvis_Label.glb?alt=media&token=0c5bf622-25ad-4162-be53-103b65dd00c9');
                unityInstance.SendMessage('GlbImporterManager', 'DownloadTextFile', 'https://firebasestorage.googleapis.com/v0/b/test2-repo.appspot.com/o/Pelvis%2FFull_Pelvis_Text.txt?alt=media&token=2d8543b1-f75d-434c-9bcc-e2c0e9e22015');
            };

            redbutton.onclick = () => {
                unityInstance.SendMessage('GlbImporterManager', 'DownloadFile', 'https://firebasestorage.googleapis.com/v0/b/test2-repo.appspot.com/o/UpperLimb%2FUL_Label.glb?alt=media&token=4605d9ce-ccf6-42b8-841d-ce52886bd4c8');
                unityInstance.SendMessage('GlbImporterManager', 'DownloadTextFile', 'https://firebasestorage.googleapis.com/v0/b/test2-repo.appspot.com/o/UpperLimb%2FUL_Text.txt?alt=media&token=55ff38ab-d3dc-40b5-af66-7baef79b8ace');
            };

            //button to pass JSON Object (string) into Unity WebGL viewer
            jsonbutton.onclick = () => {
                var testObject = { name: "JSON Object Works" };
                var jsonString = JSON.stringify(testObject);
                unityInstance.SendMessage('JavascriptHook', 'JSButtonText', jsonString);
            };

            //button to fullscreen
            fullscreenButton.onclick = () => {
                unityInstance.SetFullscreen(1);
            };
        });
    </script>
    <script>
        //Delete the "/idbfs" database when the page is loaded. Security to prevent models staying on client's machines after the session.
        window.onload = function () {
            let request = indexedDB.deleteDatabase('/idbfs');

            request.onerror = function (event) {
                console.log('Error deleting database: ' + event.target.errorCode);
            };

            request.onsuccess = function (event) {
                console.log('Database deleted successfully');
                console.log(request);
            };
        };
    </script>
</body>
</html>


